improved some code related to block entities
fixed some issues